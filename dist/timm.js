// Generated by CoffeeScript 1.10.0

/*
| Timm
| (c) Guillermo Grau Panea 2016
| License: MIT
 */

(function() {
  var INVALID_ARGS, _clone, _deepFreeze, _isObject, _merge, _setIn, _throw, addDefaults, addFirst, addLast, getIn, insert, merge, mergeIn, removeAt, replaceAt, set, setIn, updateIn,
    slice = [].slice;

  INVALID_ARGS = 'INVALID_ARGS';

  _throw = function(msg) {
    throw new Error(msg);
  };

  _clone = function(obj) {
    var i, key, keys, len1, out;
    if (Array.isArray(obj)) {
      return [].concat(obj);
    }
    keys = Object.keys(obj);
    out = {};
    for (i = 0, len1 = keys.length; i < len1; i++) {
      key = keys[i];
      out[key] = obj[key];
    }
    return out;
  };

  _merge = function(fAddDefaults) {
    var args, fChanged, i, idx, j, key, keys, len, len1, obj, out, ref;
    args = arguments;
    len = args.length;
    out = args[1];
    !(out != null) && _throw(process.env.NODE_ENV !== 'production' ? "At least one object should be provided to merge()" : INVALID_ARGS);
    fChanged = false;
    for (idx = i = 2, ref = len; i < ref; idx = i += 1) {
      obj = args[idx];
      if (obj == null) {
        continue;
      }
      keys = Object.keys(obj);
      if (!keys.length) {
        continue;
      }
      for (j = 0, len1 = keys.length; j < len1; j++) {
        key = keys[j];
        if (fAddDefaults && out[key] !== void 0) {
          continue;
        }
        if (obj[key] === out[key]) {
          continue;
        }
        if (!fChanged) {
          fChanged = true;
          out = _clone(out);
        }
        out[key] = obj[key];
      }
    }
    return out;
  };

  _isObject = function(o) {
    var type;
    type = typeof o;
    return (o != null) && (type === 'object' || type === 'function');
  };

  _deepFreeze = function(obj) {
    var i, key, len1, ref, val;
    Object.freeze(obj);
    ref = Object.getOwnPropertyNames(obj);
    for (i = 0, len1 = ref.length; i < len1; i++) {
      key = ref[i];
      val = obj[key];
      if (_isObject(val) && !Object.isFrozen(val)) {
        _deepFreeze(val);
      }
    }
    return obj;
  };

  addLast = function(array, val) {
    var out;
    if (Array.isArray(val)) {
      return array.concat(val);
    }
    out = array.concat([val]);
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  addFirst = function(array, val) {
    var out;
    if (Array.isArray(val)) {
      return val.concat(array);
    }
    out = [val].concat(array);
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  insert = function(array, idx, val) {
    var out;
    out = array.slice(0, idx).concat(Array.isArray(val) ? val : [val]).concat(array.slice(idx));
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  removeAt = function(array, idx) {
    var out;
    out = array.slice(0, idx).concat(array.slice(idx + 1));
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  replaceAt = function(array, idx, newItem) {
    var out;
    if (array[idx] === newItem) {
      return array;
    }
    out = array.slice(0, idx).concat([newItem]).concat(array.slice(idx + 1));
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  getIn = function(obj, path) {
    var i, len1, ptr, segment;
    !(Array.isArray(path)) && _throw(process.env.NODE_ENV !== 'production' ? "A path array should be provided when calling getIn()" : INVALID_ARGS);
    ptr = obj;
    if (ptr == null) {
      return void 0;
    }
    for (i = 0, len1 = path.length; i < len1; i++) {
      segment = path[i];
      ptr = ptr != null ? ptr[segment] : void 0;
      if (ptr === void 0) {
        return ptr;
      }
    }
    return ptr;
  };

  set = function(obj, key, val) {
    var out;
    if (obj == null) {
      obj = {};
    }
    if (obj[key] === val) {
      return obj;
    }
    out = _clone(obj);
    out[key] = val;
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  setIn = function(obj, path, val) {
    var out;
    if (path.length) {
      out = _setIn(obj, path, val, 0);
    } else {
      out = val;
    }
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  _setIn = function(obj, path, val, idx) {
    var key, nestedObj, newValue;
    key = path[idx];
    if (idx === path.length - 1) {
      newValue = val;
    } else {
      nestedObj = _isObject(obj) ? obj[key] : {};
      newValue = _setIn(nestedObj, path, val, idx + 1);
    }
    return set(obj, key, newValue);
  };

  updateIn = function(obj, path, fnUpdate) {
    var nextVal, prevVal;
    prevVal = getIn(obj, path);
    nextVal = fnUpdate(prevVal);
    return setIn(obj, path, nextVal);
  };

  merge = function(a, b, c, d, e, f) {
    var out;
    if (arguments.length <= 6) {
      out = _merge(false, a, b, c, d, e, f);
    } else {
      out = _merge.apply(null, [false].concat(slice.call(arguments)));
    }
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  mergeIn = function(a, path, b, c, d, e, f) {
    var mergeArgs, nextVal, prevVal;
    prevVal = getIn(a, path);
    if (prevVal == null) {
      prevVal = {};
    }
    if (arguments.length <= 7) {
      nextVal = _merge(false, prevVal, b, c, d, e, f);
    } else {
      mergeArgs = [false, prevVal].concat([].slice.call(arguments, 2));
      nextVal = _merge.apply(null, mergeArgs);
    }
    return setIn(a, path, nextVal);
  };

  addDefaults = function(a, b, c, d, e, f) {
    var out;
    if (arguments.length <= 6) {
      out = _merge(true, a, b, c, d, e, f);
    } else {
      out = _merge.apply(null, [true].concat(slice.call(arguments)));
    }
    if (process.env.NODE_ENV !== 'production') {
      _deepFreeze(out);
    }
    return out;
  };

  module.exports = {
    addLast: addLast,
    addFirst: addFirst,
    insert: insert,
    removeAt: removeAt,
    replaceAt: replaceAt,
    getIn: getIn,
    set: set,
    setIn: setIn,
    updateIn: updateIn,
    merge: merge,
    mergeIn: mergeIn,
    addDefaults: addDefaults
  };

}).call(this);
